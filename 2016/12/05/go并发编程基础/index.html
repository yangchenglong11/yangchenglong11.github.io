<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
  
  <title>go并发编程基础 | yangcl&#39;s</title>
  <meta name="author" content="Yang Chenglong" />

  
  <meta name="description" content="Yangcl&#39;s Blog" />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

  <meta property="og:title" content="go并发编程基础" />
  <meta property="og:site_name" content="yangcl&#39;s" />

  
  

  
    <meta property="og:image" content="" />
  

  
  <link href="/css/images/favicon.ico" rel="icon" />
  

  <link rel="alternate" href="/atom.xml" title="yangcl&#39;s" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  


  <!-- baidu webmaster push -->
  <script src='//push.zhanzhang.baidu.com/push.js'></script>

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">yangcl&#39;s</a></h1>
  <h2><a href="/">悟已往之不谏，知来者之可追。</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/atom.xml">RSS</a></li>
    
      <li><a href="https://github.com/yangchenglong11">github</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-12-05T05:54:54.000Z"><a href="/2016/12/05/go并发编程基础/">2016-12-05</a></time>
      
      
  
    <h1 class="title">go并发编程基础</h1>
  

    </header>
    <div class="entry">
      
        <p>并发其主要思想是使多个任务可以在同一时间执行以便能够更快的得到结果。并发编程的思想来自于多任务操作系统。</p>
<a id="more"></a>
<p>多任务操作系统允许同时运行多个程序。与之相对的是单用户计算机系统的操作系统，任务是被一个接一个的读取，寻找资源并运行的，各任务的运行完全是串行的。</p>
<p>并发程序内部会被划分为多个部分，每个部分都可以被看作是一个串行程序，在这些串行程序之间可能会存在交互的需求，这就需要操作系统去协调。在这之前，我们先来看下进程。</p>
<h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><p>我们通常把一个程序的执行称为一个进程，同时进程也被用来描述程序的执行过程。</p>
<p>一个进程可以使用系统调用fork创建若干新的进程。前者被称为后者的父进程，每一个进程都有父进程。所有的进程共同组成了一个树状结构，内核启动进程作为进程树的根并负责系统的初始化操作。它的父进程就是它自己。</p>
<p>为了管理进程，内核必须对每个进程的属性，行为进行详细的记录，包括进程的优先级，状态，虚拟地址范围以及各种访问权限等等。这些信息都会被记录在每个进程的进程描述符中，而被保存在进程描述符中的进程ID(常叫做PID)是进程在操作系统中的唯一标识，同时进程描述符中还会包含当前进程的父进程的ID(常被称为PPID)。</p>
<p>进程的状态共有6个，分别是可运行状态，可中断的睡眠状态，不可中断的睡眠状态，暂停状态或跟踪状态，僵尸状态和退出状态。</p>
<p>linux操作系统可以凭借cpu快速在多个进程之间切换，以产生多个进程在同时运行的假象。但切换正在运行的进程是需要付出代价的。</p>
<p>内核对进程的合理切换和调度使多个进程可以有条不紊的并发执行，在很多时候，多个进程之间需要相互配合并合作完成一个任务，这就需要进程间通讯机制(IPC)的支持。下面就讲一下go语言支持的IPC方法。它们是管道，信号和Socket。</p>
<h2 id="管道"><a href="#管道" class="headerlink" title="管道"></a>管道</h2><p>管道(pipe)是一种是单向的通讯方式。它只能被用于父进程与子进程以及同祖先的子进程之间的通讯。例如，我们在使用shell命令的时候常常会用到管道：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bogon:~ yang$ <span class="keyword">ps</span> aux | <span class="keyword">grep</span> <span class="keyword">go</span></div></pre></td></tr></table></figure>
<p>shell命令为每个命令都创建一个进程，然后把左边的命令的标准输出用管道与右边的命令的标准输入连接起来。</p>
<p>管道的优点在于它的简单，而缺点则是只能单向通讯以及对通讯双方关系上的严格限制。</p>
<p>对于管道，go语言是支持的。通过标准库代码包os/exec中的API，我们可以执行操作系统命令并在此基础上建立管道。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"bufio"</span></div><div class="line">	<span class="string">"bytes"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io"</span></div><div class="line">	<span class="string">"os/exec"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	demo1()</div><div class="line">	fmt.Println()</div><div class="line">	demo2()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo2</span><span class="params">()</span></span> &#123;</div><div class="line">	fmt.Println(<span class="string">"Run command `ps aux | grep apipe`: "</span>)</div><div class="line">	cmd1 := exec.Command(<span class="string">"ps"</span>, <span class="string">"aux"</span>)</div><div class="line">	cmd2 := exec.Command(<span class="string">"grep"</span>, <span class="string">"apipe"</span>)</div><div class="line">	stdout1, err := cmd1.StdoutPipe()</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: Can not obtain the stdout pipe for command: %s"</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> err := cmd1.Start(); err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: The command can not running: %s\n"</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="comment">//使用带缓冲的读取器可以非常方便和灵活的读取需要的内容，而不是只能先把所有内容读出来再作处理</span></div><div class="line">	outputBuf1 := bufio.NewReader(stdout1)</div><div class="line">        <span class="comment">//StdinPipe方法返回一个在命令Start后与命令标准输入关联的管道</span></div><div class="line">	stdin2, err := cmd2.StdinPipe()</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: Can not obtain the stdin pipe for command: %s\n"</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="comment">//WriteTo把所属值中缓存的数据全部写入到参数值代表的写入器中</span></div><div class="line">	outputBuf1.WriteTo(stdin2)</div><div class="line">	<span class="keyword">var</span> outputBuf2 bytes.Buffer</div><div class="line">	cmd2.Stdout = &amp;outputBuf2</div><div class="line">	<span class="keyword">if</span> err := cmd2.Start(); err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: The command can not be startup: %s\n"</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	err = stdin2.Close()</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: Can not close the stdio pipe: %s\n"</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="comment">//wait会一直阻塞到所属命令完全运行结束为止</span></div><div class="line">	<span class="keyword">if</span> err := cmd2.Wait(); err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: Can not wait for the command: %s\n"</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	fmt.Printf(<span class="string">"%s\n"</span>, outputBuf2.Bytes())</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo1</span><span class="params">()</span></span> &#123;</div><div class="line">	useBufferIo := <span class="literal">false</span></div><div class="line">	fmt.Println(<span class="string">"Run command `echo -n \"My first command from golang.\"`: "</span>)</div><div class="line">	cmd0 := exec.Command(<span class="string">"echo"</span>, <span class="string">"-n"</span>, <span class="string">"My first command from golang."</span>)</div><div class="line">	<span class="comment">//创建一个能获取此命令输出的管道</span></div><div class="line">	stdout0, err := cmd0.StdoutPipe()</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: Can not obtain the stdout pipe for command No.0: %s\n"</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> err := cmd0.Start(); err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: The command No.0 can not be startup: %s\n"</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> !useBufferIo &#123;</div><div class="line">		<span class="keyword">var</span> outputBuf0 bytes.Buffer</div><div class="line">		<span class="keyword">for</span> &#123;</div><div class="line">			tempOutput := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">5</span>)</div><div class="line">			<span class="comment">//Read把读出的数据存入调用方传递给他的字节切片</span></div><div class="line">			n, err := stdout0.Read(tempOutput)</div><div class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">				<span class="keyword">if</span> err == io.EOF &#123;</div><div class="line">					<span class="keyword">break</span></div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					fmt.Printf(<span class="string">"Error: Can not read data from the pipe: %s\n"</span>, err)</div><div class="line">					<span class="keyword">return</span></div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">if</span> n &gt; <span class="number">0</span> &#123;</div><div class="line">				outputBuf0.Write(tempOutput[:n])</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		fmt.Printf(<span class="string">"%s\n"</span>, outputBuf0.String())</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		outputBuf0 := bufio.NewReader(stdout0)</div><div class="line">		output0, _, err := outputBuf0.ReadLine()</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Printf(<span class="string">"Error: Can not read data from the pipe: %s\n"</span>, err)</div><div class="line">			<span class="keyword">return</span></div><div class="line">		&#125;</div><div class="line">		fmt.Printf(<span class="string">"%s\n"</span>, <span class="keyword">string</span>(output0))</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面我们讲的是匿名管道，与之相对的是命名管道。与匿名管道不同，任何进程都可以通过命名管道交换数据。实际上，命名管道以文件的形式存在于文件系统中，使用它的方法与使用文件类似，linux支持使用shell命令创建和使用命名管道，例如：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">bogon:<span class="keyword">test</span> yang$ mkfifo -<span class="keyword">m</span> 644 myfifo2</div><div class="line">bogon:<span class="keyword">test</span> yang$ tee of_login &lt; myfifo2 &amp;</div><div class="line">[1] 10028</div><div class="line">bogon:<span class="keyword">test</span> yang$ vi tepipi.txt</div><div class="line">bogon:<span class="keyword">test</span> yang$ <span class="keyword">cat</span> tepipi.txt &gt;myfifo2</div><div class="line">[1]+  Done                    tee of_login &lt; myfifo2</div></pre></td></tr></table></figure>
<p>在上面的实例中，我们先使用命令mkfifo在当前目录创建了一个命名管道mififo2，然后又使用这个命名管道和命名tee把tepipe.txt文件中的内容写到了of_login文件中。</p>
<p>这里只是使用了命名管道搬运了数据，我们也可以在此基础上实现诸如数据的过滤或转换，以及管道的多路复用等功能。注意，命名管道默认是阻塞式的，更具体的说，只有在对这个命令管道的读操作和写操作都已准备就绪后，数据才会流转。它相对于匿名管道的优势就是通讯双方可以毫不相关。但命名管道也是单向的。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io"</span></div><div class="line">	<span class="string">"os"</span></div><div class="line">	<span class="string">"time"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	fileBasedPipe()</div><div class="line">	inMemorySyncPipe()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">fileBasedPipe</span><span class="params">()</span></span> &#123;</div><div class="line">	reader, writer, err := os.Pipe()</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: Can not create the named pipe: %s\n"</span>, err)</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//命名管道默认会在其中一端还未就绪时阻塞另一端的进程</span></div><div class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		output := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">100</span>)</div><div class="line">		n, err := reader.Read(output)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Printf(<span class="string">"Error: Can not read data from the named pipe: %s\n"</span>, err)</div><div class="line">		&#125;</div><div class="line">		fmt.Printf(<span class="string">"Read %d byte(s). [file-based pipe]\n"</span>, n)</div><div class="line">	&#125;()</div><div class="line">	input := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">26</span>)</div><div class="line">	<span class="keyword">for</span> i := <span class="number">65</span>; i &lt;= <span class="number">90</span>; i++ &#123;</div><div class="line">		input[i<span class="number">-65</span>] = <span class="keyword">byte</span>(i)</div><div class="line">	&#125;</div><div class="line">	n, err := writer.Write(input)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: Can not write data to the named pipe: %s\n"</span>, err)</div><div class="line">	&#125;</div><div class="line">	fmt.Printf(<span class="string">"Written %d byte(s). [file-based pipe]\n"</span>, n)</div><div class="line">	time.Sleep(<span class="number">200</span> * time.Millisecond)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">inMemorySyncPipe</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="comment">//与上面的两个命名管道不同，这两个是被存于内存中的，有原子性操作保证的管道</span></div><div class="line">	reader, writer := io.Pipe()</div><div class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		output := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">100</span>)</div><div class="line">		n, err := reader.Read(output)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Printf(<span class="string">"Error: Can not read data from the named pipe: %s\n"</span>, err)</div><div class="line">		&#125;</div><div class="line">		fmt.Printf(<span class="string">"Read %d byte(s). [in-memory pipe]\n"</span>, n)</div><div class="line">	&#125;()</div><div class="line">	input := <span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">26</span>)</div><div class="line">	<span class="keyword">for</span> i := <span class="number">65</span>; i &lt;= <span class="number">90</span>; i++ &#123;</div><div class="line">		input[i<span class="number">-65</span>] = <span class="keyword">byte</span>(i)</div><div class="line">	&#125;</div><div class="line">	n, err := writer.Write(input)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Error: Can not write data to the named pipe: %s\n"</span>, err)</div><div class="line">	&#125;</div><div class="line">	fmt.Printf(<span class="string">"Written %d byte(s). [in-memory pipe]\n"</span>, n)</div><div class="line">	time.Sleep(<span class="number">200</span> * time.Millisecond)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="信号"><a href="#信号" class="headerlink" title="信号"></a>信号</h2><p>它是IPC中唯一一种异步的通讯方法。它的本质是利用软件来模拟硬件的中断机制。信号被用来通知某个进程有某个事件发生了。使用kill命令查看当前系统支持的信号。</p>
<p>linux支持的信号有62种，分别分为两大类，1到31号为标准信号，也叫不可靠信号，34到64为实时信号，也叫可靠信号。</p>
<p>对同一进程来说，每种标准信号只会被记录并处理一次，并且如果某一进程的标准信号种类有好多，其处理顺序也是完全不确定的。而实时信号正好相反，即同种类的多个信号都可以被记录，并且可以按照发送的顺序被处理。</p>
<p>进程响应信号的方式有3种：忽略，捕捉和执行默认操作 .</p>
<p>linux对每个标准信号都有默认的操作方式。对大多数标准信号，我们可以自定义当进程接收到他们之后进行怎样的处理。在程序中，这些作为信号响应的自定义操作往往是由函数来代表的。</p>
<p>go命令会对其中的一些以键盘输入为来源的标准信号作出相应。这是由于go命令使用了在标准库代码包os/signal 中的被用于处理信号的API。</p>
<p>下面我们看下os.Signal接口类型的声明：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">type</span> Signal <span class="keyword">interface</span> &#123;</div><div class="line">  String() <span class="keyword">string</span></div><div class="line">  Signal() <span class="comment">// to distinguish from other Stringers</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从声明可知，其中的Signal()方法的声明并没有实际意义。它只是作为os.Signal接口类型的一个标识。</p>
<p>在标准库代码包syscall中，已经为不同的操作系统的所支持的每一个标准信号都声明了一个同名常量，其类型都为syscall.Signal——os.Signal接口类型的一个实现类型，同时也是一个int类型的别名类型。每个信号常量的整数值与他所代表的信号在操作系统中的编号一致。</p>
<p>代码包os/signal 中的Notify函数用来把操作系统发给当前进程的指定信号通知给该函数的调用方。声明如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Notify</span><span class="params">(c <span class="keyword">chan</span>&lt;- os.Signal, sig ...os.Signal)</span></span></div></pre></td></tr></table></figure>
<p>signal处理程序在向接受通道发送值的时候，并不会因为通道已满而产生阻塞。</p>
<p>前面说过，大部分的标准信号我们都可以自定义其处理方法，不过有两种信号除外。SIGKILL和SIGSTOP。对他们的响应只执行系统默认操作。</p>
<p>对于其他信号，我们可以自行处理也可以恢复对他们的系统默认操作，这需要使用到os/signal包中的Stop函数。声明如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">Stop</span><span class="params">(c <span class="keyword">chan</span>&lt;- os.Signal)</span></span></div></pre></td></tr></table></figure>
<p>只需将Notify中的输入通道作为参数传入即可取消对这些信号的自行处理。</p>
<p>当然，我们也可以只对部分信号取消自定义处理，这时可以重新调用Notify函数，只需要第一个参数相同即可。</p>
<p>下面通过一个程序来实现以下功能：</p>
<p>1.执行一系列操作系统命令并获取演示进程的进程ID；</p>
<p>2.使用该进程值之上的API相对应的进程发送一个SIGINT信号，并输出演示进程已受到信号的凭证。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"bytes"</span></div><div class="line">	<span class="string">"errors"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io"</span></div><div class="line">	<span class="string">"os"</span></div><div class="line">	<span class="string">"os/exec"</span></div><div class="line">	<span class="string">"os/signal"</span></div><div class="line">	<span class="string">"runtime/debug"</span></div><div class="line">	<span class="string">"strconv"</span></div><div class="line">	<span class="string">"strings"</span></div><div class="line">	<span class="string">"sync"</span></div><div class="line">	<span class="string">"syscall"</span></div><div class="line">	<span class="string">"time"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		time.Sleep(<span class="number">5</span> * time.Second)</div><div class="line">		sigSendingDemo()</div><div class="line">	&#125;()</div><div class="line">	sigHandleDemo()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">sigHandleDemo</span><span class="params">()</span></span> &#123;</div><div class="line">	sigRecv1 := <span class="built_in">make</span>(<span class="keyword">chan</span> os.Signal, <span class="number">1</span>)</div><div class="line">	sigs1 := []os.Signal&#123;syscall.SIGINT, syscall.SIGQUIT&#125;</div><div class="line">	fmt.Printf(<span class="string">"Set notification for %s... [sigRecv1]\n"</span>, sigs1)</div><div class="line">	signal.Notify(sigRecv1, sigs1...)</div><div class="line">	sigRecv2 := <span class="built_in">make</span>(<span class="keyword">chan</span> os.Signal, <span class="number">1</span>)</div><div class="line">	sigs2 := []os.Signal&#123;syscall.SIGQUIT&#125;</div><div class="line">	fmt.Printf(<span class="string">"Set notification for %s... [sigRecv2]\n"</span>, sigs2)</div><div class="line">	signal.Notify(sigRecv2, sigs2...)</div><div class="line"></div><div class="line">	<span class="keyword">var</span> wg sync.WaitGroup</div><div class="line">	wg.Add(<span class="number">2</span>)</div><div class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		<span class="comment">//在sigRecv通道被关闭后，for语句会立即被退出执行</span></div><div class="line">		<span class="keyword">for</span> sig := <span class="keyword">range</span> sigRecv1 &#123;</div><div class="line">			fmt.Printf(<span class="string">"Received a signal from sigRecv1: %s\n"</span>, sig)</div><div class="line">		&#125;</div><div class="line">		fmt.Printf(<span class="string">"End. [sigRecv1]\n"</span>)</div><div class="line">		wg.Done()</div><div class="line">	&#125;()</div><div class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		<span class="keyword">for</span> sig := <span class="keyword">range</span> sigRecv2 &#123;</div><div class="line">			fmt.Printf(<span class="string">"Received a signal from sigRecv2: %s\n"</span>, sig)</div><div class="line">		&#125;</div><div class="line">		fmt.Printf(<span class="string">"End. [sigRecv2]\n"</span>)</div><div class="line">		wg.Done()</div><div class="line">	&#125;()</div><div class="line"></div><div class="line">	fmt.Println(<span class="string">"Wait for 3 seconds... "</span>)</div><div class="line">	time.Sleep(<span class="number">3</span> * time.Second)</div><div class="line">	fmt.Printf(<span class="string">"Stop notification..."</span>)</div><div class="line">	signal.Stop(sigRecv1)</div><div class="line">	<span class="built_in">close</span>(sigRecv1)</div><div class="line">	fmt.Printf(<span class="string">"done. [sigRecv1]\n"</span>)</div><div class="line">	wg.Wait()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">sigSendingDemo</span><span class="params">()</span></span> &#123;</div><div class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		<span class="keyword">if</span> err := <span class="built_in">recover</span>(); err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Printf(<span class="string">"Fatal Error: %s\n"</span>, err)</div><div class="line">			debug.PrintStack()</div><div class="line">		&#125;</div><div class="line">	&#125;()</div><div class="line">	<span class="comment">// ps aux | grep "mysignal" | grep -v "grep" | grep -v "go run" | awk '&#123;print $2&#125;'</span></div><div class="line">	cmds := []*exec.Cmd&#123;</div><div class="line">		exec.Command(<span class="string">"ps"</span>, <span class="string">"aux"</span>),</div><div class="line">		exec.Command(<span class="string">"grep"</span>, <span class="string">"mysignal"</span>),</div><div class="line">		exec.Command(<span class="string">"grep"</span>, <span class="string">"-v"</span>, <span class="string">"grep"</span>),</div><div class="line">		exec.Command(<span class="string">"grep"</span>, <span class="string">"-v"</span>, <span class="string">"go run"</span>),</div><div class="line">		exec.Command(<span class="string">"awk"</span>, <span class="string">"&#123;print $2&#125;"</span>),</div><div class="line">	&#125;</div><div class="line">	output, err := runCmds(cmds)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"Command Execution Error: %s\n"</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	pids, err := getPids(output)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"PID Parsing Error: %s\n"</span>, err)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	fmt.Printf(<span class="string">"Target PID(s):\n%v\n"</span>, pids)</div><div class="line">	<span class="keyword">for</span> _, pid := <span class="keyword">range</span> pids &#123;</div><div class="line">		proc, err := os.FindProcess(pid)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Printf(<span class="string">"Process Finding Error: %s\n"</span>, err)</div><div class="line">			<span class="keyword">return</span></div><div class="line">		&#125;</div><div class="line">		sig := syscall.SIGQUIT</div><div class="line">		fmt.Printf(<span class="string">"Send signal '%s' to the process (pid=%d)...\n"</span>, sig, pid)</div><div class="line">		err = proc.Signal(sig)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Printf(<span class="string">"Signal Sending Error: %s\n"</span>, err)</div><div class="line">			<span class="keyword">return</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">getPids</span><span class="params">(strs []<span class="keyword">string</span>)</span> <span class="params">([]<span class="keyword">int</span>, error)</span></span> &#123;</div><div class="line">	pids := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</div><div class="line">	<span class="keyword">for</span> _, str := <span class="keyword">range</span> strs &#123;</div><div class="line">		pid, err := strconv.Atoi(strings.TrimSpace(str))</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</div><div class="line">		&#125;</div><div class="line">		pids = <span class="built_in">append</span>(pids, pid)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> pids, <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">runCmds</span><span class="params">(cmds []*exec.Cmd)</span> <span class="params">([]<span class="keyword">string</span>, error)</span></span> &#123;</div><div class="line">	<span class="keyword">if</span> cmds == <span class="literal">nil</span> || <span class="built_in">len</span>(cmds) == <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">"The cmd slice is invalid!"</span>)</div><div class="line">	&#125;</div><div class="line">	first := <span class="literal">true</span></div><div class="line">	<span class="keyword">var</span> output []<span class="keyword">byte</span></div><div class="line">	<span class="keyword">var</span> err error</div><div class="line">	<span class="keyword">for</span> _, cmd := <span class="keyword">range</span> cmds &#123;</div><div class="line">		fmt.Printf(<span class="string">"Run command: %v ...\n"</span>, getCmdPlaintext(cmd))</div><div class="line">		<span class="keyword">if</span> !first &#123;</div><div class="line">			<span class="keyword">var</span> stdinBuf bytes.Buffer</div><div class="line">			stdinBuf.Write(output)</div><div class="line">			cmd.Stdin = &amp;stdinBuf</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">var</span> stdoutBuf bytes.Buffer</div><div class="line">		cmd.Stdout = &amp;stdoutBuf</div><div class="line">		<span class="keyword">if</span> err = cmd.Start(); err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, getError(err, cmd)</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> err = cmd.Wait(); err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, getError(err, cmd)</div><div class="line">		&#125;</div><div class="line">		output = stdoutBuf.Bytes()</div><div class="line">		<span class="comment">//fmt.Printf("Output:\n%s\n", string(output))</span></div><div class="line">		<span class="keyword">if</span> first &#123;</div><div class="line">			first = <span class="literal">false</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	lines := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>)</div><div class="line">	<span class="keyword">var</span> outputBuf bytes.Buffer</div><div class="line">	outputBuf.Write(output)</div><div class="line">	<span class="keyword">for</span> &#123;</div><div class="line">		line, err := outputBuf.ReadBytes(<span class="string">'\n'</span>)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			<span class="keyword">if</span> err == io.EOF &#123;</div><div class="line">				<span class="keyword">break</span></div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				<span class="keyword">return</span> <span class="literal">nil</span>, getError(err, <span class="literal">nil</span>)</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		lines = <span class="built_in">append</span>(lines, <span class="keyword">string</span>(line))</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> lines, <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">getCmdPlaintext</span><span class="params">(cmd *exec.Cmd)</span> <span class="title">string</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> buf bytes.Buffer</div><div class="line">	buf.WriteString(cmd.Path)</div><div class="line">	<span class="keyword">for</span> _, arg := <span class="keyword">range</span> cmd.Args[<span class="number">1</span>:] &#123;</div><div class="line">		buf.WriteRune(<span class="string">' '</span>)</div><div class="line">		buf.WriteString(arg)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> buf.String()</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">getError</span><span class="params">(err error, cmd *exec.Cmd, extraInfo ...<span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> errMsg <span class="keyword">string</span></div><div class="line">	<span class="keyword">if</span> cmd != <span class="literal">nil</span> &#123;</div><div class="line">		errMsg = fmt.Sprintf(<span class="string">"%s  [%s %v]"</span>, err, (*cmd).Path, (*cmd).Args)</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		errMsg = fmt.Sprintf(<span class="string">"%s"</span>, err)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(extraInfo) &gt; <span class="number">0</span> &#123;</div><div class="line">		errMsg = fmt.Sprintf(<span class="string">"%s (%v)"</span>, errMsg, extraInfo)</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> errors.New(errMsg)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>参考<a href="https://book.douban.com/subject/26244729/" target="_blank" rel="external">Go并发编程实战</a></p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href='javascript:void(0)' class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/Golang/">Golang</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/Golang/">Golang</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:yangchenglong11.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/Docker/">Docker</a><small>1</small></li>
  
    <li><a href="/categories/Golang/">Golang</a><small>15</small></li>
  
    <li><a href="/categories/Linux/">Linux</a><small>4</small></li>
  
    <li><a href="/categories/MongoDB/">MongoDB</a><small>4</small></li>
  
    <li><a href="/categories/Network/">Network</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">最新文章</h3>
  <ul class="entry">
    
      <li>
        <a href="/2018/01/14/Network学习笔记/">Network学习笔记</a>
      </li>
    
      <li>
        <a href="/2017/07/12/flag/">flag</a>
      </li>
    
      <li>
        <a href="/2017/05/26/channel示例之GoTocket/">channel示例之GoTocket</a>
      </li>
    
      <li>
        <a href="/2017/05/16/cobra/">cobra</a>
      </li>
    
      <li>
        <a href="/2017/05/04/bufio/">bufio 源码解读</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Docker/">Docker</a><small>1</small></li>
  
    <li><a href="/tags/Golang/">Golang</a><small>16</small></li>
  
    <li><a href="/tags/Linux/">Linux</a><small>4</small></li>
  
    <li><a href="/tags/MongoDB/">MongoDB</a><small>4</small></li>
  
    <li><a href="/tags/Network/">Network</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">标签云</h3>
  <div class="entry">
    <a href="/tags/Docker/" style="font-size: 10px;">Docker</a> <a href="/tags/Golang/" style="font-size: 20px;">Golang</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a> <a href="/tags/Network/" style="font-size: 10px;">Network</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  <p>
  
  &copy; 2018 Yang Chenglong
  
  All rights reserved.</p>
  <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</div>
<div class="clearfix"></div>

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id='bg'></div>
  
    <script type="text/javascript" src="/live2d/script.js"></script>
    <canvas id="live2dcanvas" width="300" height="400" class="live2d"></canvas>
    <style>
      #live2dcanvas {
        position: fixed;
        right: 0px;
        z-index: 999;
        pointer-events: none;
        bottom: -50px;
      }
    </style>
    <script>loadlive2d("live2dcanvas" ,"/live2d/assets/tororo/tororo.model.json",0.5)</script>
  
</body>
</html>